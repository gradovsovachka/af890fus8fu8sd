<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Mail</title>
<style>
body { font-family: Arial; display:flex; height:100vh; margin:0 }
#login { padding:20px }
#app { display:none; width:100% }
#list { width:40%; border-right:1px solid #ccc; overflow:auto }
#view { flex:1; padding:10px }
li { cursor:pointer; padding:6px }
li:hover { background:#eee }
</style>
</head>
<body>

<div id="login">
  <h3>Login</h3>
  <input id="email" placeholder="email"><br><br>
  <input id="pass" type="password" placeholder="password"><br><br>
  <button onclick="login()">Login</button>
</div>

<div id="app">
  <div id="list"></div>
  <div id="view"></div>
</div>

<script>
let AUTH = {};

async function api(action, data = {}) {
  const r = await fetch("/api/mail", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ action, ...data })
  });
  if (!r.ok) throw await r.text();
  return r.json();
}

async function login() {
  AUTH = { email: email.value, password: pass.value };
  try {
    await api("login", AUTH);
    login.style.display = "none";
    app.style.display = "flex";
    loadInbox();
  } catch {
    alert("Login failed");
  }
}

async function loadInbox() {
  const mails = await api("inbox", AUTH);
  list.innerHTML = mails.map(m =>
    `<li onclick="readMail(${m.uid})">${m.subject || "(no subject)"}</li>`
  ).join("");
}

async function readMail(uid) {
  const m = await api("read", { ...AUTH, uid });
  view.innerHTML = `
    <h3>${m.subject}</h3>
    <p>${m.from}</p>
    <div>${m.html || m.text}</div>
    <button onclick="delMail(${uid})">Delete</button>
  `;
}

async function delMail(uid) {
  await api("delete", { ...AUTH, uid });
  view.innerHTML = "";
  loadInbox();
}
</script>

</body>
</html>
